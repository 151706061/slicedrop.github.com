<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Slicer4 WebGL Export</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" href="css/xtheme/jquery.ui.css" type="text/css"
	charset="utf-8" />
<link type="text/css" rel="stylesheet" href="css/jquery.miniColors.css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.ui.js"></script>
<script type="text/javascript" src="js/jquery.miniColors.min.js"></script>
<script type="text/javascript" src="js/xtk.js"></script>

<script type="text/javascript">
  // script snippet for the menu animation
  jQuery(function() {

    
    jQuery(".color-picker").miniColors({
      letterCase: 'uppercase',
      change: function(hex, rgb) {
        logData(hex, rgb);
      }
    });    
    
    jQuery('#navigation .menu').stop().animate({
      'marginLeft': '-195px'
    }, 1000);
    
    jQuery('#volume').hover(function() {

      jQuery('.menu', jQuery(this)).stop().animate({
        'marginLeft': '-2px'
      }, 200);
    }, function() {


        jQuery('.menu', jQuery(this)).stop().animate({
          'marginLeft': '-195px'
        }, 200);

    });
    
    jQuery('#mesh').hover(function() {

      jQuery('.menu', jQuery(this)).stop().animate({
        'marginLeft': '-2px'
      }, 200);
    }, function() {


        jQuery('.menu', jQuery(this)).stop().animate({
          'marginLeft': '-195px'
        }, 200);

    });
    
    jQuery('#fibers').hover(function() {

      jQuery('.menu', jQuery(this)).stop().animate({
        'marginLeft': '-2px'
      }, 200);
    }, function() {


        jQuery('.menu', jQuery(this)).stop().animate({
          'marginLeft': '-195px'
        }, 200);

    });
    
    // create the 2d sliders
    jQuery("#yellow_slider").slider();
    jQuery("#red_slider").slider();
    jQuery("#green_slider").slider();
    
    
    jQuery("#labelmapname").change(function() {

    });
    
    jQuery("#scalarname").change(function() {

    });
    
  });
  
  jQuery(document)
      .ready(
          function() {

            
            //
            // The X Toolkit code
            //
            
            threeD = new X.renderer3D();
            threeD.container = '3d';
            threeD.init();
            

            //
            // create the 2D renderers
            // .. for the X orientation
            sliceX = new X.renderer2D();
            sliceX.container = 'sliceX';
            sliceX.orientation = 'X';
            sliceX.init();
            
            sliceY = new X.renderer2D();
            sliceY.container = 'sliceY';
            sliceY.orientation = 'Y';
            sliceY.init();
            
            sliceZ = new X.renderer2D();
            sliceZ.container = 'sliceZ';
            sliceZ.orientation = 'Z';
            sliceZ.init();
            
            //
            // THE VOLUME DATA
            //
            // create a X.volume
            volume = new X.volume();
            // .. and attach the single-file dicom in .NRRD format
            // this works with gzip/gz/raw encoded NRRD files but XTK also supports other
            // formats like MGH/MGZ
            volume.file = 'http://x.babymri.org/?vol.nrrd';
            // we also attach a label map to show segmentations on a slice-by-slice base
            volume.labelmap.file = 'http://x.babymri.org/?seg.nrrd';
            // .. and use a color table to map the label map values to colors
            volume.labelmap.colortable.file = 'http://x.babymri.org/?genericanatomy.txt';
            
            // add the volume in the main renderer
            // we choose the sliceX here, since this should work also on
            // non-webGL-friendly devices like Safari on iOS
            sliceX.add(volume);
            
            //
            // LINK THE RENDERERS
            //
            // link the 2d renderers to the 3d one by setting the onScroll
            // method. this means, once you scroll in 2d, it upates 3d as well
            var _updateThreeD = function() {

              // only if we support webgl, update the 3d renderer
              volume.modified();
              threeD.render();
              
              // update the jquery sliders
              jQuery("#yellow_slider").slider("option", "value", volume.indexX);
              jQuery("#red_slider").slider("option", "value", volume.indexY);
              jQuery("#green_slider").slider("option", "value", volume.indexZ);
              
            };
            sliceX.onScroll = _updateThreeD;
            sliceY.onScroll = _updateThreeD;
            sliceZ.onScroll = _updateThreeD;
            
            // load 2 meshes
            var mesh1 = new X.mesh();
            mesh1.file = 'http://x.babymri.org/?avf.vtk';
            mesh1.color = [1, 0, 0];
            // and also set the visibility to false, since we add a 'load-on-demand'
            // option for it
            mesh1.visible = true;
            threeD.add(mesh1);
            
            var mesh2 = new X.mesh();
            mesh2.file = 'http://x.babymri.org/?avf.vtk';
            mesh2.color = [0, 1, 0];
            // and also set the visibility to false, since we add a 'load-on-demand'
            // option for it
            mesh2.visible = false;
            threeD.add(mesh2);
            

            // start the loading/rendering
            sliceX.render();
            
            sliceX.onShowtime = function() {

              threeD.add(volume);
              sliceY.add(volume);
              sliceZ.add(volume);
              
              threeD.render();
              sliceY.render();
              sliceZ.render();
              

              jQuery("#yellow_slider").slider("option", "value", volume.indexX);
              jQuery("#yellow_slider").slider("option", "max",
                  volume.dimensions[0] - 1);
              jQuery("#yellow_slider .ui-slider-handle").unbind('keydown');
              jQuery("#yellow_slider").bind("slide", function(event, ui) {

                volume.indexX = ui.value;
                volume.modified();
                threeD.render();
                sliceX.render();
                sliceY.render();
                sliceZ.render();
              });
              
              jQuery("#red_slider").slider("option", "value", volume.indexY);
              jQuery("#red_slider").slider("option", "max",
                  volume.dimensions[1] - 1);
              jQuery("#red_slider .ui-slider-handle").unbind('keydown');
              jQuery("#red_slider").bind("slide", function(event, ui) {

                volume.indexY = ui.value;
                volume.modified();
                threeD.render();
                sliceX.render();
                sliceY.render();
                sliceZ.render();
              });
              
              jQuery("#green_slider").slider("option", "value", volume.indexZ);
              jQuery("#green_slider").slider("option", "max",
                  volume.dimensions[2] - 1);
              jQuery("#green_slider .ui-slider-handle").unbind('keydown');
              jQuery("#green_slider").bind("slide", function(event, ui) {

                volume.indexZ = ui.value;
                volume.modified();
                threeD.render();
                sliceX.render();
                sliceY.render();
                sliceZ.render();
              });
              
              jQuery("#threshold-volume").slider({
                min: volume.min,
                max: volume.max,
                range: true,
                values: [volume.lowerThreshold, volume.upperThreshold],
                slide: function(event, ui) {

                  volume.lowerThreshold = ui.values[0];
                  volume.upperThreshold = ui.values[1];
                  volume.modified();
                  threeD.render();
                  sliceX.render();
                  sliceY.render();
                  sliceZ.render();
                  
                }
              
              });
              jQuery("#threshold-volume").css('width', '160px');
              
              jQuery("#opacity-volume").slider({
                min: 0,
                max: 100,
                value: 100,
                slide: function(event, ui) {

                  volume.opacity = ui.value / 100;
                  volume.modified();
                  threeD.render();
                  
                }
              
              });
              jQuery("#opacity-volume").css('width', '160px');
              
              jQuery("#opacity-labelmap").slider({
                min: 0,
                max: 100,
                value: 100,
                slide: function(event, ui) {

                  volume.labelmap.opacity = ui.value / 100;
                  volume.modified();
                  sliceX.render();
                  sliceY.render();
                  sliceZ.render();
                  threeD.render();
                  
                }
              
              });
              jQuery("#opacity-labelmap").css('width', '160px');
              
              jQuery("#opacity-mesh").slider({
                min: 0,
                max: 100,
                value: 100
              });
              jQuery("#opacity-mesh").css('width', '160px');
              
              jQuery("#opacity-scalar").slider({
                min: 0,
                max: 100,
                value: 100
              });
              jQuery("#opacity-scalar").css('width', '160px');

              jQuery("#visibility-mesh").button();
              jQuery('#visibility-mesh').click(function() {

                var _checked = jQuery(this).is(':checked');
                
                eval(jQuery("#meshname").val() + ".visible = " + _checked);
                eval(jQuery("#meshname").val() + ".modified()");
                
                threeD.render();
              });
              

              jQuery("#volumerendering").button();
              jQuery("#volumerendering").css('font-size', '10px');
              jQuery('#volumerendering').click(function() {

                var _checked = jQuery('#volumerendering').is(':checked');
                
                if (_checked) {
                  jQuery("#volumerendering-visible").show();
                } else {
                  jQuery("#volumerendering-visible").hide();
                }
                
                volume.volumeRendering = _checked;
                volume.modified();
                threeD.render();
                
              });
              jQuery("#volumerendering-visible").hide();
              
              jQuery("#meshname").change(function() {

                // update GUI with mesh info
                
                // get color
                var color = eval(jQuery(this).val() + ".color");
                //set value
                
                // get opacity
                //var opacity = eval(jQuery(this).val() + ".opacity");
                
                // get visibility
                var visible = eval(jQuery(this).val() + ".visible");
                jQuery("#visibility-mesh").prop("checked", visible);
                
                jQuery('#visibility-mesh').button("refresh");
              });
            

              // customize slider look and feeld
              jQuery('.ui-slider').height(5);
              jQuery('.ui-slider-handle').height(10);
              jQuery('.ui-slider-handle').width(10);
              //jQuery('.ui-slider-handle').css('margin-top', '2.5px');
              jQuery('.ui-widget').css('font-size', '10px');
              jQuery('.ui-widget').css('letter-spacing', '1px');
              jQuery('.ui-corner-all').css('-moz-border-radius', '2px');
              jQuery('.ui-corner-all').css('-webkit-border-radius', '2px');
              


            };
            
          })
</script>

<style>
ul#navigation {
	position: fixed;
	margin: 0px;
	padding: 0px;
	top: 50px;
	left: 0px;
	list-style: none;
	z-index: 9999;
}

ul#navigation li {
	width: 100px;
}

ul#navigation li .menu {
	display: block;
	margin-left: -195px;
	width: 200px;
	height: 150px;
	background-color: #000;
	background-repeat: no-repeat;
	background-position: center center;
	border: 1px solid #AFAFAF;
	-moz-border-radius: 0px 2px 2px 0px;
	-webkit-border-bottom-right-radius: 2px;
	-webkit-border-top-right-radius: 2px;
	-khtml-border-bottom-right-radius: 2px;
	-khtml-border-top-right-radius: 2px;
	-moz-box-shadow: 0px 4px 3px #000;
	-webkit-box-shadow: 0px 4px 3px #000;
	opacity: 0.8;
	filter: progid:DXImageTransform.Microsoft.Alpha(opacity=80 );
	margin-left: -195px;
}

body {
	background: #000;
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	color: #fff;
	margin: 0;
	padding: 0;
	height: 100%;
	overflow: hidden !important;
	margin: 0;
}

#yellow_slider {
	margin-top: 2px;
	background: yellow;
}

#red_slider {
	margin-top: 2px;
	background: red;
}

#green_slider {
	margin-top: 2px;
	background: green;
}

.caption {
	float: right;
	position: relative;
	right: 0px;
	width: 10px;
	height: 70px;
	margin-top: 0px;
	font-size: smaller;
	-moz-transform: rotate(90deg); /* FF3.5+ */
	-o-transform: rotate(90deg); /* Opera 10.5 */
	-webkit-transform: rotate(90deg);
}

.label {
	letter-spacing: 1px;
	font-size: x-small;
}

.content {
	float: left;
	padding-left: 15px;
	line-height: 20px;
}

.pin {
	float: right;
	position: relative;
	margin-top: 0px;
	right: 0px;
	top: 0px;
}

.switch {
	float: left;
	position: relative;
	margin-top: 0px;
	right: 0px;
	top: 0px;
}

</style>
</head>
<body>
	<ul id="navigation">
		<li id="volume"><a class='menu'>
        <div class="pin">
          <span class="ui-icon ui-icon-pin-s" id="volumepin"></span>
        </div>
				<div class="content">
					<input type="checkbox" id="volumerendering" /><label
						for="volumerendering">VOLUMERENDERING</label>
					<div id="volumerendering-visible">
						<div class="label">OPACITY</div>
						<div id="opacity-volume"></div>
					</div>

					<div class="label">THRESHOLD</div>
					<div id="threshold-volume"></div>

					<div class="label">
						LABEL NAME <select id="labelmapname">
							<option value="Default">Default</option>
							<option value="None">None</option>
						</select>
					</div>

					<div class="label">LABEL OPACITY</div>
					<div id="opacity-labelmap"></div>

					<div class="label">
						COLOR TABLE <select id="colortablename">
							<option value="Default">Default</option>
							<option value="None">None</option>
						</select>
					</div>
				</div>
				<div class="caption">VOLUME</div>
		</a></li>
		<li id="mesh"><a class='menu'>
				<div class="pin">
					<span class="ui-icon ui-icon-pin-s" id="meshpin"></span>
				</div>
				<div class="content">
					<div class="label">
						NAME <select id="meshname">
							<option value="mesh1">mesh1</option>
							<option value="mesh2">mesh2</option>
						</select>
					</div>

					<div>
						<input type="checkbox" id="visibility-mesh" checked /><label
							for="visibility-mesh">VISIBILITY</label>
					</div>

					<input type="hidden" name="color4" class="color-picker black"
						size="6" />

					<div class="label">OPACITY</div>
					<div id="opacity-mesh"></div>

					<div class="label">
						SCALAR <select id=scalarname">
							<option value="None">None</option>
							<option value="02">02</option>
							<option value="03">03</option>
						</select>
					</div>

					<div class="label">OPACITY</div>
					<div id="opacity-scalar"></div>
				</div>
				<div class="caption">MESH</div>
		</a></li>
		<li id="fibers"><a class='menu'>
        <div class="pin">
          <span class="ui-icon ui-icon-pin-s" id="fiberspin"></span>
        </div>
				<div class="content">
<div id="tabs2" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
                <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
                  <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#tabs2-1">First</a></li>
                  <li class="ui-state-default ui-corner-top"><a href="#tabs2-2">Second</a></li>
                  <li class="ui-state-default ui-corner-top"><a href="#tabs2-3">Third</a></li>
                </ul>
                <div id="tabs2-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse eget diam nec urna hendrerit tempus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum aliquam ligula non nulla cursus volutpat. Aliquam malesuada felis nec turpis auctor interdum. Cras et lobortis dolor. Nam sodales, dolor eu cursus faucibus, justo leo vestibulum turpis, id malesuada erat ipsum et leo. Integer id aliquam augue. Proin quis risus magna.</p>
                  <a href="#" id="sampleButton" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button"><span class="ui-button-text">Change</span></a>
                </div>
                <div id="tabs2-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">Tab 2</div>
                <div id="tabs2-3" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">Tab 3</div>
              </div>
				<span class="ui-state-default ui-corner-all ui-icon ui-icon-dark ui-icon-info"></span>
				
				</div>
				<div class="caption">FIBERS</div>
		</a> </span></li>
	</ul>
	<div id="3d"
		style="background-color: #000; width: 80%; height: 100%; position: absolute; right: 20%; left: 0%; bottom: 0%; top: 0%;">
	</div>
	<div id="sliceX"
		style="border-left: thin solid #666; background-color: #000; width: 20%; height: 33.3%; position: absolute; right: 0%; top: 0%;">
		<div id="yellow_slider"></div>
	</div>
	<div id="sliceY"
		style="border-left: thin solid #666; background-color: #000; width: 20%; height: 33.3%; position: absolute; right: 0%; top: 33%;">
		<div id="red_slider"></div>
	</div>
	<div id="sliceZ"
		style="border-left: thin solid #666; background-color: #000; width: 20%; height: 33.3%; position: absolute; right: 0%; top: 66%;">
		<div id="green_slider"></div>
	</div>
</body>
</html>
